<!DOCTYPE html>
<html>
  <head>
    <title>実験</title>
    <meta http-equiv="Content-Type"  content="text/html; charset=UTF-8">
    <!-- jQuery の読み込み jsPsychよりも先に読み込むこと。 -->
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/platform.js"></script>
    <script src="jspsych-6.3.1/jspsych.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-select.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
    <!--提示刺激-->
    <script src="stim_v2.js"></script>
    <script src="stim_test3.js"></script>
    <script src="trial.js"></script>
    <!--同意画面-->
    <script src="informedConsent.js"></script>
    <link href="jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css">
    <script src="jspsych-6.3.1/plugins/jspsych-fullscreen.js"></script>

    <!-- カーソルを一時的に削除 -->
    <script src="js/hide_cursor.js"></script>
   <style>
       ::-webkit-scrollbar {
       display: none;
       }
       #jspsych-content {
           max-width: 100%; /* this is mainly an IE 10-11 fix */
           text-align: center;
           margin: auto; /* this is for overflowing content */
       }
    </style>
  </head>
  <body>
  </body>
  <script>
    var welcome = {
      type: 'html-keyboard-response',
      stimulus: "研究にご参加いただきありがとうございます。"+
      // "<br>"+
      // "<br>"+
      // "<br>"+
      "<br>よろしければSを押してください",
      choices:['s']
    };
    var fullscreen = {
      type: 'fullscreen',
      message: '<p>以下のボタンをクリックすると，画面は全画面表示に切り替わります。実験中は，邪魔にならない様に一定時間経過するとカーソルを隠す設定にしています。カーソルは動かすと再度表示されます。実験を途中で辞めたい場合はEscキーを押してください。</p>',
      button_label: "全画面表示に切り替え",
      fullscreen_mode: true
    };

    var par_id = {
      type: 'survey-text',
      questions: [
        {prompt: '参加者IDを入力してください', columns: 10, required: true, name: 'participantID'},
        {prompt: '年齢を入力してください', columns: 3, required: true, name: 'age'},
      ],
      on_load: function(trial){
         var element_id = document.getElementById('input-0')
         var element_age = document.getElementById('input-1')
         element_id.type = 'number'
         element_age.type = 'number'
      },
      button_label: '次へ',
    };
    var gender = {
      type: 'survey-multi-choice',
      questions: [
        {prompt: "性別を選択してください", options: ['男性', '女性'], required: false, horizontal: true, name: 'gender'},
      ],
      button_label: '次へ',
    };

    var test = {
      timeline: [fixation, flip1, flip2, flip3, flip4, question, judgement],
      timeline_variables: stim_test3,
      randomize_order:true
    }

    const NotChrome = {
        type: 'html-keyboard-response',
        stimulus: '申し訳ありません。このブラウザでは実施できません。Chromeにて実施してください。',
        choices: jsPsych.NO_KEYS,
        on_finish: function (data) {
            jsPsych.endExperiment('');
        }
    };
    const NotPC = {
        type: 'html-keyboard-response',
        stimulus: '申し訳ありません。スマートフォンでは実施できません。パソコンにて実施してください。',
        choices: jsPsych.NO_KEYS,
        on_finish: function (data) {
            jsPsych.endExperiment('');
        }
    };

    var timeline = [];

    var brName = platform.name.toLowerCase();
    var osName = platform.os.toString().toLowerCase();
    if(brName.indexOf("chrome") !== -1) {
      if(osName.indexOf("android") !== -1 | osName.indexOf("ios") !== -1) {
        timeline.push(NotPC);
      }
      else {
        timeline.push(welcome);
        timeline.push(par_id);
        timeline.push(gender);
        timeline.push(informedConsent);
        timeline.push(fullscreen);
        timeline.push(test);
      }
    }
    else {
      timeline.push(NotChrome);
    }
    var end_message = {
      type: 'html-keyboard-response',
      stimulus: '<p>以上で実験は終了です。スペースキーを押してください。Escキーでフルスクリーンモードを解除できます</p>',
     }
    timeline.push(end_message);
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.get().localSave('csv', 'data.csv');
      }
    });
  </script>
</html>
